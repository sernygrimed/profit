<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>电商智能利润模型 - 店铺独立版</title>

 <!-- 1. 引入 Tailwind CSS (样式引擎) -->
 <script src="https://cdn.tailwindcss.com"></script>

 <!-- 2. 引入 React 和 ReactDOM (核心框架) -->
 <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
 <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

 <!-- 3. 引入 Babel (用于在浏览器中运行 JSX) -->
 <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>



 <!-- 4. 字体设置 & 动画 -->
 <style>
 body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
 .fade-in { animation: fadeIn 0.5s ease-in-out; }
 @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
 /* 隐藏数字输入框的箭头 */
 input[type=number]::-webkit-inner-spin-button, 
 input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
 </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">



 <div id="root"></div>



 <script type="text/babel">
 const { useState, useEffect } = React;



 // --- 图标组件 ---
 const Icons = {
 Calculator: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></svg>,
 Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
 Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
 TrendingUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
 TrendingDown: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></svg>,
 Store: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></svg>,
 Calendar: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
 BarChart3: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/></svg>,
 Settings: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
 };



 const DynamicProfitCalculator = () => {
 // 默认参数常量
 const DEFAULT_PARAMS = {
 grossMargin: 55, // 默认 55%
 refundRate: 35   // 默认 35%
 };



 // 1. 视图模式 (日维度/月维度)
 const [viewMode, setViewMode] = useState('daily');



 // 2. 店铺数据 State (现在包含每个店铺独立的 grossMargin 和 refundRate)
 const DEFAULT_STORES = [
 { id: 1, name: '店铺 1', fixedCost: 50000, dailyAdSpend: 3000, adSpendPercent: 14, grossMargin: 55, refundRate: 35 },
 { id: 2, name: '店铺 2', fixedCost: 10000, dailyAdSpend: 1000, adSpendPercent: 15, grossMargin: 55, refundRate: 35 },
 ];
 const [stores, setStores] = useState(DEFAULT_STORES);

 // 3. 汇总数据
 const [summary, setSummary] = useState({ totalNet: 0, totalRevenue: 0 });



 // 格式化金额
 const formatMoney = (amount) => Math.round(amount).toLocaleString('zh-CN');



 // 核心计算函数 (现在读取 store 内部的参数)
 const calculateStoreMetrics = (store) => {
 const dailyAdSpend = parseFloat(store.dailyAdSpend) || 0;
 const adSpendPercent = parseFloat(store.adSpendPercent) || 0;
 const fixedCostMonth = parseFloat(store.fixedCost) || 0;

 // 获取当前店铺的配置参数，如果没有则使用默认值
 const currentGrossMargin = store.grossMargin !== undefined ? parseFloat(store.grossMargin) : DEFAULT_PARAMS.grossMargin;
 const currentRefundRate = store.refundRate !== undefined ? parseFloat(store.refundRate) : DEFAULT_PARAMS.refundRate;



 // 计算有效毛利率: 毛利 * (1 - 退款率)
 const effectiveRate = (currentGrossMargin / 100) * (1 - currentRefundRate / 100);



 // 1. 日营业额
 const dailyRevenue = adSpendPercent > 0 ? dailyAdSpend / (adSpendPercent / 100) : 0;

 // 2. 有效毛利
 const effectiveGrossProfitDay = dailyRevenue * effectiveRate;

 // 3. 日固定成本
 const dailyFixedCost = fixedCostMonth / 30;

 // 4. 日净利润
 const dailyNetProfit = effectiveGrossProfitDay - dailyAdSpend - dailyFixedCost;



 return {
 params: {
 effectiveRate
 },
 daily: {
 revenue: dailyRevenue,
 fixedCost: dailyFixedCost,
 adSpend: dailyAdSpend,
 grossProfit: effectiveGrossProfitDay,
 netProfit: dailyNetProfit
 },
 monthly: {
 revenue: dailyRevenue * 30,
 fixedCost: fixedCostMonth,
 adSpend: dailyAdSpend * 30,
 grossProfit: effectiveGrossProfitDay * 30,
 netProfit: dailyNetProfit * 30
 }
 };
 };



 const updateStore = (id, field, value) => {
 // 限制百分比输入在 0-100 之间
 if (field === 'grossMargin' || field === 'refundRate' || field === 'adSpendPercent') {
 let numVal = parseFloat(value);
 if (numVal < 0) numVal = 0;
 if (numVal > 100) numVal = 100;
 value = isNaN(numVal) ? '' : numVal; // 允许暂时留空以便输入
 }

 setStores(stores.map(store => 
 store.id === id ? { ...store, [field]: value } : store
 ));
 };



 const addStore = () => {
 const newId = stores.length > 0 ? Math.max(...stores.map(s => s.id)) + 1 : 1;
 setStores([...stores, {
 id: newId,
 name: `店铺 ${newId}`,
 fixedCost: 10000, 
 dailyAdSpend: 0,
 adSpendPercent: 15,
 grossMargin: DEFAULT_PARAMS.grossMargin, // 新店默认 55
 refundRate: DEFAULT_PARAMS.refundRate    // 新店默认 35
 }]);
 };



 const removeStore = (id) => {
 setStores(stores.filter(store => store.id !== id));
 };



 useEffect(() => {
 let totalNet = 0;
 let totalRevenue = 0;



 stores.forEach(store => {
 const metrics = calculateStoreMetrics(store);
 totalNet += metrics[viewMode].netProfit;
 totalRevenue += metrics[viewMode].revenue;
 });



 setSummary({ totalNet, totalRevenue });
 }, [stores, viewMode]);



 const ViewToggle = () => (
 <div className="flex bg-slate-200/50 p-1 rounded-lg w-full md:w-auto mt-2 md:mt-0">
 <button
 onClick={() => setViewMode('daily')}
 className={`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all ${viewMode === 'daily' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
 >
 <Icons.Calendar /> 日维度视图
 </button>
 <button
 onClick={() => setViewMode('monthly')}
 className={`flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all ${viewMode === 'monthly' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
 >
 <Icons.BarChart3 /> 月维度视图 (预测)
 </button>
 </div>
 );



 return (
 <div className="min-h-screen p-4 md:p-8">
 <div className="max-w-6xl mx-auto fade-in">

 {/* Header */}
 <header className="mb-8">
 <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
 <h1 className="text-3xl font-bold text-slate-900 flex items-center gap-2">
 <span className="text-blue-600"><Icons.Calculator /></span>
 电商智能利润模型
 </h1>
 <ViewToggle />
 </div>



 {/* Summary Dashboard */}
 <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col md:flex-row items-center gap-8 justify-between">
 <div className="text-center md:text-left flex-1">
 <div className="text-sm text-slate-500 mb-1">
 {viewMode === 'daily' ? '全店总营业额 (日)' : '全店总营业额 (月预测)'}
 </div>
 <div className="text-4xl font-bold text-slate-800 tracking-tight">
 ¥{formatMoney(summary.totalRevenue)}
 </div>
 <div className="text-xs text-slate-400 mt-2">
 *汇总所有店铺数据，金额已取整
 </div>
 </div>

 <div className={`flex-1 w-full md:w-auto px-8 py-6 rounded-xl shadow-sm border flex flex-col items-center justify-center transition-colors duration-500 ${summary.totalNet >= 0 ? 'bg-emerald-50 border-emerald-100 text-emerald-800' : 'bg-red-50 border-red-100 text-red-800'}`}>
 <div className="text-sm font-semibold uppercase tracking-wider opacity-70 mb-2">
 {viewMode === 'daily' ? '全店净利润 (日)' : '全店净利润 (月预测)'}
 </div>
 <div className="text-4xl font-extrabold flex items-center gap-2">
 {summary.totalNet >= 0 ? <Icons.TrendingUp /> : <Icons.TrendingDown />}
 ¥{formatMoney(summary.totalNet)}
 </div>
 </div>
 </div>
 </header>



 {/* Stores Grid */}
 <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
 {stores.map((store) => {
 const allMetrics = calculateStoreMetrics(store);
 const currentMetrics = allMetrics[viewMode];
 const isProfitable = currentMetrics.netProfit >= 0;



 return (
 <div key={store.id} className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden hover:shadow-md transition-shadow duration-300 relative group">
 {/* Tag */}
 <div className={`absolute top-0 right-0 px-3 py-1 text-xs font-bold text-white rounded-bl-lg z-10 transition-colors ${viewMode==='daily' ? 'bg-blue-500' : 'bg-purple-500'}`}>
 {viewMode === 'daily' ? '日维度数据' : '月维度数据'}
 </div>



 {/* Card Title */}
 <div className="bg-slate-50 px-6 py-4 border-b border-slate-200 flex justify-between items-center mt-2">
 <div className="flex items-center gap-2 font-bold text-slate-700">
 <span className="text-slate-400"><Icons.Store /></span>
 <input 
 type="text" value={store.name} onChange={(e) => updateStore(store.id, 'name', e.target.value)}
 className="bg-transparent border-none focus:ring-0 p-0 font-bold text-slate-700 w-40 truncate outline-none hover:text-blue-600 transition-colors"
 />
 </div>
 {stores.length > 1 && (
 <button onClick={() => removeStore(store.id)} className="text-slate-400 hover:text-red-500 transition-colors p-1 rounded hover:bg-red-50"><Icons.Trash2 /></button>
 )}
 </div>



 <div className="p-6">
 {/* Section 1: Product Strategy (Margin & Refund) */}
 <div className="mb-4">
 <div className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-1">
 <Icons.Settings size={12}/> 产品策略参数
 </div>
 <div className="grid grid-cols-2 gap-4 bg-orange-50/50 p-3 rounded-lg border border-orange-100/50">
 <div>
 <label className="block text-xs font-medium text-slate-500 mb-1">产品毛利率 (%)</label>
 <div className="relative">
 <input type="number" value={store.grossMargin} onChange={(e) => updateStore(store.id, 'grossMargin', e.target.value)} className="w-full pl-2 pr-6 py-1.5 bg-white border border-slate-200 rounded focus:ring-2 focus:ring-orange-400 font-bold text-slate-700 outline-none" />
 <span className="absolute right-2 top-1.5 text-slate-400">%</span>
 </div>
 </div>
 <div>
 <label className="block text-xs font-medium text-slate-500 mb-1">平均退款率 (%)</label>
 <div className="relative">
 <input type="number" value={store.refundRate} onChange={(e) => updateStore(store.id, 'refundRate', e.target.value)} className="w-full pl-2 pr-6 py-1.5 bg-white border border-slate-200 rounded focus:ring-2 focus:ring-orange-400 font-bold text-slate-700 outline-none" />
 <span className="absolute right-2 top-1.5 text-slate-400">%</span>
 </div>
 </div>
 </div>
 <div className="text-[10px] text-right text-slate-400 mt-1 mr-1">
 当前有效毛利: {((allMetrics.params.effectiveRate)*100).toFixed(2)}%
 </div>
 </div>



 {/* Section 2: Operational Inputs */}
 <div className="mb-6">
 <div className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">运营成本参数</div>
 <div className="grid grid-cols-3 gap-3">
 <div>
 <label className="block text-xs font-medium text-slate-500 mb-1">日付费金额</label>
 <input type="number" value={store.dailyAdSpend} onChange={(e) => updateStore(store.id, 'dailyAdSpend', e.target.value)} className="w-full px-2 py-1.5 bg-slate-50 border border-slate-200 rounded focus:ring-2 focus:ring-blue-500 font-medium outline-none text-sm" placeholder="0" />
 </div>
 <div>
 <label className="block text-xs font-medium text-slate-500 mb-1">付费占比 (%)</label>
 <div className="relative">
 <input type="number" value={store.adSpendPercent} onChange={(e) => updateStore(store.id, 'adSpendPercent', e.target.value)} className="w-full pl-2 pr-6 py-1.5 bg-slate-50 border border-slate-200 rounded focus:ring-2 focus:ring-blue-500 font-medium outline-none text-sm" placeholder="15" />
 <span className="absolute right-2 top-1.5 text-slate-400 text-xs">%</span>
 </div>
 </div>
 <div>
 <label className="block text-xs font-medium text-slate-500 mb-1">月固定成本</label>
 <input type="number" value={store.fixedCost} onChange={(e) => updateStore(store.id, 'fixedCost', e.target.value)} className="w-full px-2 py-1.5 bg-slate-50 border border-slate-200 rounded focus:ring-2 focus:ring-blue-500 font-medium outline-none text-sm" placeholder="10000" />
 </div>
 </div>
 </div>



 {/* Results Section */}
 <div className={`rounded-xl p-4 border transition-colors duration-300 ${viewMode === 'daily' ? 'bg-slate-50 border-slate-100' : 'bg-purple-50 border-purple-100'}`}>
 <h4 className="text-xs font-bold text-slate-400 mb-3 uppercase tracking-wider flex justify-between">
 <span>{viewMode === 'daily' ? '今日数据测算' : '本月数据预测 (×30天)'}</span>
 </h4>
 <div className="grid grid-cols-2 gap-y-4 text-sm mb-4">
 <div className="flex flex-col">
 <span className="text-slate-500 text-xs">{viewMode === 'daily' ? '日营业额' : '月营业额'} (估算)</span>
 <span className="font-semibold text-slate-700 text-lg">¥{formatMoney(currentMetrics.revenue)}</span>
 </div>
 <div className="flex flex-col text-right">
 <span className="text-slate-500 text-xs">{viewMode === 'daily' ? '日固定成本' : '月固定成本'}</span>
 <span className="font-semibold text-slate-700">¥{formatMoney(currentMetrics.fixedCost)}</span>
 </div>
 <div className="flex flex-col">
 <span className="text-slate-500 text-xs">有效毛利 (含付费)</span>
 <span className="font-semibold text-slate-700">¥{formatMoney(currentMetrics.grossProfit)}</span>
 </div>
 <div className="flex flex-col text-right">
 <span className="text-slate-500 text-xs">{viewMode === 'daily' ? '日付费成本' : '月付费成本'}</span>
 <span className="font-semibold text-slate-700 text-red-600">-¥{formatMoney(currentMetrics.adSpend)}</span>
 </div>
 </div>



 <div className="pt-4 border-t border-slate-200/50 flex justify-between items-end">
 <div>
 <div className="text-xs text-slate-500 mb-1">{viewMode === 'daily' ? '日净利润' : '月净利润预测'}</div>
 <div className={`text-2xl font-bold flex items-center gap-1 ${isProfitable ? 'text-emerald-600' : 'text-red-600'}`}>
 {isProfitable ? <Icons.TrendingUp /> : <Icons.TrendingDown />}
 ¥{formatMoney(currentMetrics.netProfit)}
 </div>
 </div>
 <div className="text-right text-xs text-slate-400">
 <div>对应{viewMode === 'daily' ? '月' : '日'}净利:</div>
 <div className={`font-semibold ${isProfitable ? 'text-emerald-500' : 'text-red-500'}`}>
 ¥{formatMoney(allMetrics[viewMode === 'daily' ? 'monthly' : 'daily'].netProfit)}
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>
 );
 })}

 {/* Add Button */}
 <button onClick={addStore} className="flex flex-col items-center justify-center h-full min-h-[450px] border-2 border-dashed border-slate-300 rounded-2xl text-slate-400 hover:text-blue-600 hover:border-blue-400 hover:bg-blue-50 transition-all duration-300 group bg-white">
 <div className="bg-slate-50 p-4 rounded-full shadow-sm mb-3 group-hover:shadow-md transition-all group-hover:bg-white text-blue-500">
 <Icons.Plus />
 </div>
 <span className="font-medium">添加新店铺</span>
 <span className="text-xs mt-1 opacity-70">默认值: 毛利55% / 退款35%</span>
 </button>
 </div>



 <div className="text-center text-slate-400 text-xs py-8">
 电商智能利润模型 (店铺独立参数版) • 纯本地运行
 </div>



 </div>
 </div>
 );
 };



 const root = ReactDOM.createRoot(document.getElementById('root'));
 root.render(<DynamicProfitCalculator />);
 </script>
</body>
</html>








